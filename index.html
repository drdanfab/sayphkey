<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Seed Syfr — Single File (Offline)</title>

  <!-- PWA -->
  <link rel="icon" type="image/png" sizes="32x32" href="/seed-syfr/icon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/seed-syfr/icon-16x16.png">
  <link rel="apple-touch-icon" href="/seed-syfr/icon-180x180.png">
  <link rel="manifest" href="/seed-syfr/manifest.json">
  <meta name="theme-color" content="#22c55e">

  <!-- CSP: block outbound; allow SW + manifest -->
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'none';
    img-src 'self' data:;
    style-src 'unsafe-inline';
    script-src 'unsafe-inline';
    worker-src 'self';
    manifest-src 'self';
    connect-src 'none';
    base-uri 'none';
    form-action 'none'
  ">

  <style>
    .safety-warning{ width:50%; margin:0 auto; padding:12px 16px; background:#fff7ed; border:1px solid #f97316; border-radius:6px; font-family:'Courier New', monospace; font-size:14px; color:#7c2d12 }
    .inline-check{ display:inline-flex; align-items:center; gap:8px; white-space:nowrap }
    :root{ --line:#111; --green:#22c55e }
    *{ box-sizing:border-box }
    body{ margin:0; background:#F8FAFC; color:#111; font:14px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif }
    .wrap{ max-width:900px; margin:24px auto; padding:20px }
    .card{ background:#fff; border:1px solid #ddd; border-radius:12px; padding:20px; box-shadow:0 1px 2px rgba(0,0,0,.04) }

    .header{ display:flex; justify-content:space-between; align-items:center; gap:16px }
    .logo-wrap{ display:flex; align-items:center; gap:12px }
    .logo-wrap svg{ display:block; max-width:280px; height:auto }

    .net{ font-size:12px; padding:8px 14px; border-radius:999px; border:1px solid #2e6f2e; background:#2e6f2e; color:#fff; font-family:'Courier New', monospace }

    label{ font-weight:700; margin-top:10px; display:block; color:#5b6d55; font-family:'Courier New', monospace }
    input,textarea{ width:100%; padding:8px; border:2px solid var(--line); border-radius:4px; font:14px 'Courier New', monospace }
    textarea{ min-height:150px; resize:vertical }

    .mode-row{ display:flex; gap:16px; margin-top:6px; flex-wrap:wrap }
    .mode-btn{ padding:16px 22px; border-radius:12px; border:2px solid #111; background:#fff; color:#111; box-shadow:0 2px 0 rgba(0,0,0,0.08); cursor:pointer }
    .mode-btn.active{ background:var(--green); color:#111; border-color:#14532d }

    .io-grid{ display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-top:8px }
    @media (max-width:700px){ .io-grid{ grid-template-columns:1fr } }

    /* Quick Start (collapsible) */
    .quickstart{ margin:16px auto 0; max-width:900px }
    .quickstart .toggle-btn{ background:var(--green); color:#111; font-family:'Courier New', monospace; font-weight:700; padding:8px 14px; border:2px solid #14532d; border-radius:8px; cursor:pointer; box-shadow:0 1px 0 rgba(0,0,0,.06) }
    .qs-content{ display:none; margin-top:12px; padding:16px 20px; background:#f9fafb; border:1px solid #ddd; border-radius:8px; font-family:'Courier New', monospace; font-size:14px; line-height:1.5 }
    .qs-content h3{ margin:0 0 8px; font-size:18px; color:#111 }
    .qs-content .important{ color:#b91c1c; font-weight:700 }

    footer{ margin:18px auto 8px; max-width:900px; color:#64748b; font:12px 'Courier New', monospace; text-align:center }
    footer .muted{ opacity:.9 }
  </style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <div class="header">
      <div class="logo-wrap" id="logoSlot">
        <svg width="220" height="40" viewBox="0 0 220 40" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Seed Syfr">
          <text x="0" y="28" font-family="Arial, Helvetica, sans-serif" font-size="28" font-weight="700" fill="#111">SEED</text>
          <text x="80" y="28" font-family="Arial, Helvetica, sans-serif" font-size="28" font-weight="700" fill="#22c55e">SYFR</text>
        </svg>
      </div>
      <div id="net" class="net">Offline</div>
    </div>

    <label>Mode</label>
    <div class="mode-row">
      <button id="encBtn" class="mode-btn">Encrypt</button>
      <button id="decBtn" class="mode-btn">Decrypt</button>
    </div>

    <div style="display:grid;grid-template-columns:1fr 200px;gap:16px;margin-top:10px">
      <div>
        <label for="keyword">Keyword</label>
        <input id="keyword" type="text" placeholder="e.g., FISH">
      </div>
      <div>
        <label for="pos">Insert Position (1–26)</label>
        <input id="pos" type="number" min="1" max="26" value="1">
      </div>
    </div>

    <div class="io-grid">
      <div>
        <label for="inText">Input Text</label>
        <textarea id="inText"></textarea>
      </div>
      <div>
        <label for="outText">Output Text</label>
        <textarea id="outText" readonly></textarea>
      </div>
    </div>
  </div>
</div>

<!-- Safety warning ABOVE Quick Start -->
<div align="center" class="safety-warning">
  <p style="font-weight:700; color:red;">
    ALWAYS DISCONNECT FROM THE INTERNET WHEN ENTERING SEED PHRASES, PASSWORDS, OR KEYWORDS.
  </p>
</div>

<!-- Collapsible Quick Start Section -->
<div class="quickstart">
  <button class="toggle-btn" onclick="toggleQuickstart()">Quick Start Steps</button>
  <div id="quickstartContent" class="qs-content">
    <h3>Quick Start Steps</h3>
    <ol>
      <li>Open this page once while online (to cache).</li>
      <li>Add to Home Screen (Safari iOS / Chrome Android).</li>
      <li>Disconnect from the internet.</li>
      <li>Choose Encrypt or Decrypt, set Keyword &amp; Position, type in the Input box — output updates automatically.</li>
    </ol>
    <p class="important">Erase decrypted text before reconnecting to the internet.</p>
  </div>
</div>

<footer>
  Seed Syfr · v0.1.0 · <span id="netStatus">Offline</span><br>
  Created by Dr Daniel Faber (<a href="mailto:drdanfab@gmail.com">drdanfab@gmail.com</a>) ·
  <a href="https://github.com/drdanfab/seed-syfr" target="_blank">View on GitHub</a><br>
  © 2025 Seed Syfr. No warranties. Use at your own risk.
</footer>

<script>
(function(){
  // Online badge (file:// aware so local use looks normal)
  var netHeader = document.getElementById('net');
  var netFooter = document.getElementById('netStatus');
  function label(s){ if(netHeader) netHeader.textContent = s; if(netFooter) netFooter.textContent = s; }

  var isFile = location.protocol === 'file:';
  if (isFile) {
    label('Local file (no network needed)');
  } else {
    function updateNet(){ label(navigator.onLine ? 'Online' : 'Offline'); }
    window.addEventListener('online', updateNet);
    window.addEventListener('offline', updateNet);
    updateNet();
  }

  var ABC = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";

  var els = {
    keyword: document.getElementById('keyword'),
    pos: document.getElementById('pos'),
    inText: document.getElementById('inText'),
    outText: document.getElementById('outText'),
    encBtn: document.getElementById('encBtn'),
    decBtn: document.getElementById('decBtn')
  };

  // Mode toggle (always auto-run)
  var currentMode = 'enc';
  function setMode(mode){
    currentMode = mode;
    els.encBtn.classList.toggle('active', mode === 'enc');
    els.decBtn.classList.toggle('active', mode === 'dec');
    scheduleRun(); // auto-run on mode change
  }
  els.encBtn.addEventListener('click', function(){ setMode('enc'); });
  els.decBtn.addEventListener('click', function(){ setMode('dec'); });
  setMode('enc');

  // Helpers
  function dedupeKeyword(k){
    k = (k || "").toUpperCase().replace(/[^A-Z]/g,'');
    var out = "", seen = {};
    for (var i=0;i<k.length;i++){ var ch = k[i]; if (!seen[ch]){ seen[ch] = true; out += ch; } }
    return out;
  }
  function buildAlphabet(keyword, insertPos){
    var key = dedupeKeyword(keyword);
    var rem = [];
    for (var i=0;i<26;i++){ var ch = ABC[i]; if (key.indexOf(ch) === -1) rem.push(ch); }
    var pos = parseInt(insertPos,10);
    if (!isFinite(pos) || pos < 1) pos = 1;
    if (pos > rem.length + 1) pos = rem.length + 1;
    var left = rem.slice(0, pos-1).join('');
    var right = rem.slice(pos-1).join('');
    var alpha = left + key + right;
    if (alpha.length !== 26) {
      var used = {}; for (var j=0;j<alpha.length;j++) used[alpha[j]] = true;
      for (var k2=0;k2<26;k2++){ var a = ABC[k2]; if(!used[a]) alpha += a; }
    }
    return alpha;
  }
  function makeMaps(alpha){
    var encU = {}, decU = {};
    for (var i=0;i<26;i++){ encU[ABC[i]] = alpha[i]; decU[alpha[i]] = ABC[i]; }
    return {
      encChar: function(ch){
        var code = ch.charCodeAt(0);
        var isLower = code >= 97 && code <= 122;
        var up = isLower ? String.fromCharCode(code - 32) : ch;
        if (encU[up]) { var m = encU[up]; return isLower ? m.toLowerCase() : m; }
        return ch;
      },
      decChar: function(ch){
        var code = ch.charCodeAt(0);
        var isLower = code >= 97 && code <= 122;
        var up = isLower ? String.fromCharCode(code - 32) : ch;
        if (decU[up]) { var m = decU[up]; return isLower ? m.toLowerCase() : m; }
        return ch;
      }
    };
  }

  function run(){
    var alpha = buildAlphabet(els.keyword.value, els.pos.value);
    var maps = makeMaps(alpha);
    var txt = els.inText.value || "";
    var out = "";
    if (currentMode === 'enc'){ for (var i=0;i<txt.length;i++) out += maps.encChar(txt[i]); }
    else { for (var j=0;j<txt.length;j++) out += maps.decChar(txt[j]); }
    els.outText.value = out;
  }

  // Debounce for auto-run
  var t;
  function scheduleRun(){ clearTimeout(t); t = setTimeout(run, 120); }

  // Wire inputs to auto-run
  ['keyup','change','input'].forEach(function(evt){
    els.inText.addEventListener(evt, scheduleRun);
    els.keyword.addEventListener(evt, scheduleRun);
    els.pos.addEventListener(evt, scheduleRun);
  });

  // Initial compute
  scheduleRun();
})();

function toggleQuickstart(){
  var qs = document.getElementById('quickstartContent');
  if (!qs) return;
  qs.style.display = (qs.style.display === 'block') ? 'none' : 'block';
}
</script>

<!-- Service Worker registration (root of repo path) -->
<script>
(function(){
  if (!('serviceWorker' in navigator) || !window.isSecureContext) return;
  navigator.serviceWorker.register('/seed-syfr/sw.js', { scope: '/seed-syfr/' }).catch(function(){});
})();
</script>
</body>
</html>
